<!DOCTYPE HTML>
<html>
<head>

    <title>doc.netmiller.fi - Apteekit</title>
    <meta charset="utf-8">

    <!-- Bootstrap, latest compiled and minified CSS -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

    <!-- doc.netmiller CSS -->
    <link rel="stylesheet" href="../common/css/nmdoc.css" type="text/css">

</head>

<body>

<div id="wrapper">

    <div id="header">
          <div id="netmiller">doc.netmiller.fi</div>
          <div id="customer">Ohjeita apteekeille - tietokoneet ja ohjelmistot</div>
    </div>

    <div id="right-bg">
        <div id="left-bg">

            <div id="over-both">

                <div id="leftcol">

                    <div id="nappulat">

                        <button type="button" class="menu-expand btn btn-default btn-xs">
                            Näytä <span class="glyphicon glyphicon-save"></span>
                        </button>
                        <button type="button" class="menu-collapse btn btn-default btn-xs">
                            Piilota <span class="glyphicon glyphicon-open"></span>
                        </button>
                        <!-- button class="btn btn-info">Expand All</button -->
                        <!-- button class="btn btn-warning">Collapse All</button -->

                    </div>

                    <div id="listTree">
                        Haetaan valikkoa ....
                    </div>

                </div>

                <div id="rightcol">
                    <div id="page"></div>
                </div>

            </div>

        </div>
    </div>

</div>


<!-- JQuery 1.x.x, latest minified JavaScript -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<!-- Bootstrap 3.x minified JavaScript -->
<script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
<!-- Underscore minified JavaScript -->
<script src="../common/js/underscore-min.js"></script>
<!-- local marked JavaScript -->
<script src="../common/js/marked.min.js"></script>
<!-- local JQuery cookie plugin -->
<script src="../common/js/jquery.cookie.js"></script>


<!-- app functions -->
<script src="../common/js/MDTree.min.js"></script>

<!-- app main script -->
<script type="text/javascript">

    $( document ).ready(function() {

        var data = [];
        var cPage = '';

        // asetetaan JQuery ajax cache:n oletus
        $.ajaxSetup({ cache:false });

        // haetaan menutiedosto
        var m = 'config/menu.json';

        $.getJSON(m, function (d) {
            //console.log(d.meta);

            data = d.menu;

            // haetaan viimeksi käsitelty sivu joko Cookiesta tai oletuksesta
            cPage = $.cookie("currPage") || d.meta.default_page;

            // muodostetaan vas.reunan valikkopuu haetun datan perusteella
            $( '#listTree' ).html(__buildTree(data, {"startCollapsed": false, "cPage": cPage}));

            // renderöidään viimeksi haettu sivu ruudulle valmiiksi
            $.get( cPage)
                .done(function( data ) {
                    $( '#page' ).html(marked(data));
                })
                .fail(function() {
                    console.log( "sivu puuttuu" );
                });
            //.always(function() {
            //    $.cookie("currPage", cPage);
            //});

            // lisätään kuuntelijat tarvittaville eventeille
            $(document)
                .on('click', '.menu-expand',function (e) {
                    //$('#listTree').listTree('expandAll');
                    __expandAll();
                })
                .on('click', '.menu-collapse',function (e) {
                    //$('#listTree').listTree('collapseAll');
                    __collapseAll();
                })

                .on('click', '#listTree > ul > li, #listTree > ul > li > i.glyphicon', function(e) {
                    __toggleMenu(e);
                })

                // otetaan kiinni vas.reunan valikosta klikattu uuden sivun eventti
                // (tahan voisi rakentaa toisen logiikan href->id -vaihtoehdon tilalle)
                .on('click', '#listTree li.page', function(e) {
                    __getDoc($(e.target), e.target.id);
                })

                // testataan sivulla olevan linkin click-eventti
                .on('click', '#page a', function(e) {
                    __getLink(e);
                })
            ;

        });

    });

</script>

</body>
</html>