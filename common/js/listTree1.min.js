(function($){var template='		<ul>			<% _.each(context, function(parent, index) { %>			<li class="section">				<span class="menu-1"><%= parent.key %><i class="glyphicon glyphicon-chevron-up"></i></span>				<% if (options.startCollapsed) { %>				<ul style="display: none;">				<% } else { %>				<ul>				<% } %>					<% _.each(parent.values, function(child, index) { %>					<li class="page" id="<%= child.href %>">					    <i class="glyphicon glyphicon-edit"></i><%= child.key %>					</li>					<% }); %>				</ul>			</li>			<% }); %>		</ul>';function _toggleIcon(jNode){if(jNode.children("ul").is(":visible")){jNode.children("span").children("i").removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down")}else{jNode.children("span").children("i").removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up")}}function getAbsolutePath(){return new RegExp("[^?]+/").exec(window.location.href)}var methods={init:function(context,options){var defaults={startCollapsed:false,selected:context};options=$.extend(defaults,options);return this.each(function(){var $this=$(this),data=$this.data("listTree");if(!data){$(this).data("listTree",{target:$this,context:context,options:options,selected:options.selected});$(document).on("click","#listTree > ul > li, #listTree > ul > li > i.glyphicon",function(e){var node=$(e.target).parentsUntil("ul");_toggleIcon(node);node.children("ul").slideToggle("fast");e.stopImmediatePropagation()}).on("click","#listTree li.page",function(e){var haku=e.target.id||"sivu-puuttuu.md";$.get(haku).done(function(data){$("#page").html(marked(data));$.cookie("currPage",haku)}).fail(function(){console.log("sivu puuttuu")})}).on("click","#page a",function(e){var haku=e.target.href||"sivu-puuttuu.md";var ap=new RegExp(getAbsolutePath());if(e.target.href.search(ap)>=0){e.preventDefault();$.get(haku).done(function(data){$("#page").html(marked(data));$.cookie("currPage",haku)}).fail(function(){console.log("linkki puuttuu: "+haku)})}else{e.target.target="_blank"}});$this.html(_.template(template,{context:context,options:options}))}})},expandAll:function(){return this.each(function(){var node=$(this).children("ul").children("li");_toggleIcon(node);node.children("ul").slideDown("fast")})},collapseAll:function(){return this.each(function(){var node=$(this).children("ul").children("li");_toggleIcon(node);node.children("ul").slideUp("fast")})},update:function(context,options){var defaults={startCollapsed:false,selected:context};options=$.extend(defaults,options);console.log("huu2");return this.each(function(){var $this=$(this),data=$this.data("listTree");if(data){$(this).data("listTree",{target:$this,context:context,options:options,selected:options.selected});$this.html($.template(template,{context:context,options:options}))}})}};$.fn.listTree=function(method){if(methods[method]){return methods[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==="object"||!method){return methods.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.listTree")}}})(jQuery);